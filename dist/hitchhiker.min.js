var Models;!function(a){var b=function(){function a(a,b){this.name=a,this.version=b}return a}();a.BrowserVersion=b;var c=function(){function a(){}return a}();a.Session=c}(Models||(Models={}));var Core;!function(a){var b;!function(a){var b=function(){function a(a,b){this.username=a,this.timestamp=b}return a.fromKey=function(b){return new a(b.split("#")[0],Number(b.split("#")[1]))},a.fromParts=function(b,c){return new a(b,c)},a.prototype.getKey=function(){return this.username+"#"+this.timestamp.toString()},a.prototype.isValid=function(){var a=new Date(Date.now()),b=new Date(this.timestamp);return b.getFullYear()==a.getFullYear()&&b.getMonth()==a.getMonth()&&b.getDay()==a.getDay()},a}();a.SessionKey=b;var c=function(){function a(a){this.sessionKey=a,this.transitId=Date.now()}return a.fromKey=function(c){var d=c.split("#")[0],e=Number(c.split("#")[1]),f=b.fromParts(d,e),g=new a(f),h=Number(c.split("#")[2]);return g.transitId=h,g},a.prototype.getKey=function(){return this.sessionKey.getKey()+"#"+this.transitId},a.prototype.isValid=function(){return Date.now()-this.transitId<54e5},a}();a.TransitKey=c}(b=a.Configuration||(a.Configuration={}))}(Core||(Core={}));var Core;!function(a){var b;!function(b){var c=a.Configuration.SessionKey,d=a.Configuration.TransitKey,e=function(){function a(b){this.Key=null;var d=JSON.parse(localStorage.getItem(a.SessionStorageKey));if(null!==d){var e=c.fromKey(d.userTrackingId);e.isValid()?(this.Key=e,this.currentSession=d):(this.Key=new c(e.username,Date.now()),this.currentSession=null)}else this.Key=new c(b,Date.now()),this.currentSession=null}return a.getInstance=function(b){return void 0!==a.instance?a.instance:(a.instance=new a(b),a.instance)},a.prototype.getPreviosSession=function(){return this.currentSession},a.prototype.storeSession=function(){localStorage.setItem(a.SessionStorageKey,JSON.stringify(this.currentSession))},a.SessionStorageKey="hitchhiker.session",a}();b.SessionStorageService=e;var f=function(){function a(a){this.sessionKey=a,this.currentTransit=null,this.Key=null;var b=this.getPrevious();if(void 0!==b&&null!==b){var c=d.fromKey(b.transitId);c.isValid()?(b.duration+=Date.now()-b.lastLoad,this.currentTransit=b,this.publish=!1,this.Key=c):(this.currentTransit=this.createTransit(a.username),this.publish=!0)}else this.currentTransit=this.createTransit(a.username),this.publish=!0}return a.getInstance=function(b){return void 0!==a.instance?a.instance:(a.instance=new a(b),a.instance)},a.prototype.storeTransit=function(){localStorage.setItem(a.TransitStorageKey,JSON.stringify(this.currentTransit))},a.prototype.getPrevious=function(){return JSON.parse(localStorage.getItem(a.TransitStorageKey))},a.prototype.createTransit=function(a){return this.Key=new d(e.getInstance(a).Key),{sessionId:e.getInstance(a).currentSession.userTrackingId,transitId:this.Key.getKey(),duration:0,createdAt:Date.now(),lastLoad:Date.now(),hits:[]}},a.TransitStorageKey="hitchhiker.transit",a}();b.TransitStorageService=f}(b=a.Storage||(a.Storage={}))}(Core||(Core={}));var Core;!function(a){var b;!function(a){var b=function(){function a(a){this.pubConf=a,this.pubUrl=a.pubUrl}return a.prototype.publish=function(a,b){void 0==b&&(b=function(){}),$.ajax({url:this.pubUrl,method:"POST",data:{payload:a}}).then(function(){b()})},a}();a.DefaultPublisher=b;var c=function(){function a(a){this.pubConf=a,this.pubUrl=a.pubUrl}return a.prototype.publish=function(a){$.ajax({url:this.pubUrl,method:"POST",data:{sessionInfo:a}})},a}();a.SessionPublisher=c;var d=function(){function a(a){this.pubConf=a,this.SessionStorageKey="hitchhiker.buttonhitpublisher";var b=JSON.parse(sessionStorage.getItem(this.SessionStorageKey));this.pubUrl=a.pubUrl,void 0!=b&&null!=b&&(b.toPage=window.location.href,this.publishAjax(b),sessionStorage.removeItem(this.SessionStorageKey))}return a.prototype.publish=function(a){sessionStorage.setItem(this.SessionStorageKey,JSON.stringify(a))},a.prototype.publishAjax=function(a){$.ajax({url:this.pubUrl,method:"POST",data:{sessionInfo:a}})},a}();a.ButtonHitPublisher=d}(b=a.Publishers||(a.Publishers={}))}(Core||(Core={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},Core;!function(a){var b;!function(b){function c(a){var b=document.cookie.split(";");for(var c in b){var d=b[c].trim().split("=");if(d[0]===a)return d[1]}}var d=Models.Session,e=Models.BrowserVersion,f=a.Storage.TransitStorageService,g=function(){function a(){}return a.prototype.then=function(){},a.prototype.registerPublisher=function(a){this.publisher=a},a}();b.IHighjacker=g,b.getCookieField=c;var h=function(a){function b(b,c){a.call(this),this.sessionKey=b,this.sessionStorageService=c}return __extends(b,a),b.prototype.sessionEvent=function(){var a=this;$(document).ready(function(){var b=new d;b.userTrackingId=a.sessionKey.getKey(),b.browser=new e(bowser.name,bowser.version),b.os=window.navigator.oscpu||window.navigator.platform,b.device={tablet:bowser.tablet===!0&&bowser.tablet,mobile:bowser.mobile===!0&&bowser.mobile},b.createdAt=Date.now(),void 0!==a.publisher&&(a.publisher.publish(b),a.sessionStorageService.currentSession=b,a.sessionStorageService.storeSession())})},b}(g);b.SessionHighjacker=h;var i=function(a){function b(b){a.call(this),this.sessionKey=b}return __extends(b,a),b.prototype.start=function(){var a=this;$(document).ready(function(){if(f.getInstance(a.sessionKey).publish){var b=f.getInstance(a.sessionKey).currentTransit;a.publisher.publish(b),f.getInstance(a.sessionKey).storeTransit()}})},b}(g);b.TransitHighjacker=i;var j=function(a){function b(b){a.call(this),this.transitKey=b,this.hit=!1}return __extends(b,a),b.prototype.getParent=function(a,b,c){return b<=c?void 0===a.attributes.href?this.getParent(a.parentElement,b++,c):a.attributes.href.value:""},b.prototype.start=function(){var a=this;$("a").click(function(b){if(!a.hit){b.preventDefault();var c=a.getParent(b.target,0,10),d=window.location.toString(),e={hitId:a.transitKey.getKey()+"#"+Date.now(),transitId:a.transitKey.getKey(),toPage:c,fromPage:d};a.e=b,a.publisher.publish(e,function(){a.hit=!0,a.e.target.click()})}})},b}(g);b.HitHighjacker=j;var k=function(a){function b(b){a.call(this),this.transitKey=b,this.hit=!1}return __extends(b,a),b.prototype.start=function(){var a=this;$(":button").click(function(b){if(!a.hit){b.preventDefault();var c=window.location.toString(),d={hitId:a.transitKey.getKey()+"#"+Date.now(),transitId:a.transitKey.getKey(),fromPage:c,toPage:""};a.e=b,a.publisher.publish(d,function(){a.hit=!0,a.e.target.click()})}})},b}(g);b.HitButtonHighjacker=k}(b=a.Highjacker||(a.Highjacker={}))}(Core||(Core={}));var Bootstrap;!function(a){function b(a){var b=new Core.Publishers.SessionPublisher({pubUrl:a.sessionTrackUrl}),f=new Core.Publishers.DefaultPublisher({pubUrl:a.transitTrackUrl}),g=new Core.Publishers.DefaultPublisher({pubUrl:a.hitTrackUrl}),h=new Core.Publishers.ButtonHitPublisher({pubUrl:a.hitTrackUrl}),i="";a.userid.isCookie===!1||void 0===a.userid.isCookie?i=a.userid.value:(i=c(a.userid.value),void 0===i&&(i=a.userid.visitor));var j=d.getInstance(i);if(null===j.getPreviosSession()){var k=new Core.Highjacker.SessionHighjacker(j.Key,j);console.log("Highjacker created!"),k.registerPublisher(b),console.log("Registering Publisher created!"),k.sessionEvent()}var l=new Core.Highjacker.TransitHighjacker(j.Key);l.registerPublisher(f),l.start();var m=new Core.Highjacker.HitHighjacker(e.getInstance(this.sessionKey).Key);m.registerPublisher(g),m.start();var n=new Core.Highjacker.HitButtonHighjacker(e.getInstance(this.sessionKey).Key);n.registerPublisher(h),n.start()}var c=Core.Highjacker.getCookieField,d=Core.Storage.SessionStorageService,e=Core.Storage.TransitStorageService;a.BasicBootstrap=b}(Bootstrap||(Bootstrap={}));